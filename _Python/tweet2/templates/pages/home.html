{% extends 'base.html' %} {% block head_title %} - Home{%endblock head_title %}
{% block content %}
<div class="row">
  <div class="col text-center">
    <h1>Welcome to Tweetme 2!</h1>
  </div>
</div>

<div class="row" id="tweets">
  Loading...
</div>

<script>
  const tweetsElement = document.getElementById("tweets");
  tweetsElement.innerHTML = "Loading...";

  const xhr = new XMLHttpRequest();
  const method = "GET";
  const url = "/tweets";
  const responseType = "json";

  function handleDidLike(tweet_id, currentCount) {}
  function likeBtn(tweet) {
    return `<button class='btn btn-primary' onclick=handleDidLike(${tweet.id}, ${tweet.likes})>Like</button>`;
  }
  function formattedTweet(tweet) {
    return `<div class="mb-4 col-12 col-md-10 mx-auto border rounded py-3 tweet" id="tweet-${tweet.id}"
                <h1>${tweet.id}</h1>
                <p>${tweet.content}</p>
                <div class="btn-group">${likeBtn(tweet)}</div>
            </div>`;
  }

  xhr.responseType = responseType;
  xhr.open(method, url);
  xhr.onload = function () {
    const serverResponse = xhr.response;
    const listedItems = serverResponse.response;
    const finalTweetStr = listedItems.map((e) => formattedTweet(e));
    tweetsElement.innerHTML = finalTweetStr;
  };
  xhr.send();
</script>
{% endblock content %}
